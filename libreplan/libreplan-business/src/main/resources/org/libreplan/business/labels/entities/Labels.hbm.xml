<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">

<hibernate-mapping package="org.libreplan.business.labels.entities" default-access="field">

    <!-- Label -->
    <class name="Label" table="label">
        <cache usage="nonstrict-read-write"/>
        <id name="id" type="long" access="property">
            <generator class="increment">
                <param name="max_lo">100</param>
            </generator>
        </id>

        <version name="version" access="property" type="long" />

        <property name="code" access="property" not-null="true" unique="true"/>
        <properties name="nameAndType" unique="true">
            <property name="name" />
            <!-- Indexed -->
            <many-to-one name="type" class="LabelType" column="label_type_id" index="idx_label_on_label_type"/>
        </properties>

        <set name="orderElements" table="order_element_label" cascade="none" inverse="true" batch-size="10">
            <key column="label_id" not-null="false"/>
            <many-to-many column="order_element_id" class="org.libreplan.business.orders.entities.OrderElement"/>
        </set>

    </class>

    <!-- LabelType -->
    <class name="LabelType" table="label_type">
        <cache usage="nonstrict-read-write"/>
        <id name="id" type="long" access="property">
            <generator class="increment">
                <param name="max_lo">100</param>
            </generator>
        </id>

        <version name="version" access="property" type="long" />

        <property name="code" access="property" not-null="true" unique="true"/>

        <property name="name" unique="true"/>

        <property name="codeAutogenerated" not-null="true" column="code_autogenerated" />

        <property name="lastLabelSequenceCode" access="field" column="last_label_sequence_code" />

        <!-- Indexed the other side -->
        <set name="labels" inverse="false" cascade="all-delete-orphan" batch-size="10">
            <cache usage="nonstrict-read-write"/>
            <key column="label_type_id"/>
            <one-to-many class="Label"/>
        </set>
    </class>

</hibernate-mapping>
